{"version":3,"file":"models.js","sourceRoot":"","sources":["../../app/ingest/models.ts"],"names":[],"mappings":"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","sourcesContent":["import ____moose____typia from \"typia\";\nimport { IngestPipeline, Key, OlapTable, DeadLetterModel, DateTime, } from \"@514labs/moose-lib\";\n/**\n * Data Pipeline: Raw Record (Foo) → Processed Record (Bar)\n * Raw (Foo) → HTTP → Raw Stream → Transform → Derived (Bar) → Processed Stream → DB Table\n */\n/** =======Data Models========= */\n/** Raw data ingested via API */\nexport interface Foo {\n    primaryKey: Key<string>; // Unique ID\n    timestamp: number; // Unix timestamp\n    optionalText?: string; // Text to analyze\n}\n/** Analyzed text metrics derived from Foo */\nexport interface Bar {\n    primaryKey: Key<string>; // From Foo.primaryKey\n    utcTimestamp: DateTime; // From Foo.timestamp\n    hasText: boolean; // From Foo.optionalText?\n    textLength: number; // From Foo.optionalText.length\n}\n/** =======Pipeline Configuration========= */\nexport const deadLetterTable = new OlapTable<DeadLetterModel>(\"FooDeadLetter\", {\n    orderByFields: [\"failedAt\"],\n}, ____moose____typia.json.schemas<[\n    import(\"@514labs/moose-lib\").StripDateIntersection<DeadLetterModel>\n]>(), JSON.parse(\"[{\\\"name\\\":\\\"originalRecord\\\",\\\"data_type\\\":\\\"Json\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"errorMessage\\\",\\\"data_type\\\":\\\"String\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"errorType\\\",\\\"data_type\\\":\\\"String\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"failedAt\\\",\\\"data_type\\\":\\\"DateTime\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"source\\\",\\\"data_type\\\":\\\"String\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[[\\\"LowCardinality\\\",true]]}]\") as any, {\n    validate: (data: unknown) => {\n        const result = ____moose____typia.createValidate<import(\"@514labs/moose-lib\").StripDateIntersection<DeadLetterModel>>()(data);\n        return {\n            success: result.success,\n            data: result.success ? result.data : undefined,\n            errors: result.success ? undefined : result.errors\n        };\n    },\n    assert: ____moose____typia.createAssert<import(\"@514labs/moose-lib\").StripDateIntersection<DeadLetterModel>>(),\n    is: ____moose____typia.createIs<import(\"@514labs/moose-lib\").StripDateIntersection<DeadLetterModel>>()\n});\n/** Raw data ingestion */\nexport const FooPipeline = new IngestPipeline<Foo>(\"Foo\", {\n    table: false, // No table; only stream raw records\n    stream: true, // Buffer ingested records\n    ingestApi: true, // POST /ingest/Foo\n    deadLetterQueue: {\n        destination: deadLetterTable,\n    },\n}, ____moose____typia.json.schemas<[\n    import(\"@514labs/moose-lib\").StripDateIntersection<Foo>\n]>(), JSON.parse(\"[{\\\"name\\\":\\\"primaryKey\\\",\\\"data_type\\\":\\\"String\\\",\\\"primary_key\\\":true,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"timestamp\\\",\\\"data_type\\\":\\\"Float\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"optionalText\\\",\\\"data_type\\\":\\\"String\\\",\\\"primary_key\\\":false,\\\"required\\\":false,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]}]\") as any, {\n    validate: (data: unknown) => {\n        const result = ____moose____typia.createValidate<import(\"@514labs/moose-lib\").StripDateIntersection<Foo>>()(data);\n        return {\n            success: result.success,\n            data: result.success ? result.data : undefined,\n            errors: result.success ? undefined : result.errors\n        };\n    },\n    assert: ____moose____typia.createAssert<import(\"@514labs/moose-lib\").StripDateIntersection<Foo>>(),\n    is: ____moose____typia.createIs<import(\"@514labs/moose-lib\").StripDateIntersection<Foo>>()\n});\n/** Buffering and storing processed records (@see transforms.ts for transformation logic) */\nexport const BarPipeline = new IngestPipeline<Bar>(\"Bar\", {\n    table: true, // Persist in ClickHouse table \"Bar\"\n    stream: true, // Buffer processed records\n    ingestApi: false, // No API; only derive from processed Foo records\n}, ____moose____typia.json.schemas<[\n    import(\"@514labs/moose-lib\").StripDateIntersection<Bar>\n]>(), JSON.parse(\"[{\\\"name\\\":\\\"primaryKey\\\",\\\"data_type\\\":\\\"String\\\",\\\"primary_key\\\":true,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"utcTimestamp\\\",\\\"data_type\\\":\\\"DateTime\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"hasText\\\",\\\"data_type\\\":\\\"Boolean\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"textLength\\\",\\\"data_type\\\":\\\"Float\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]}]\") as any, {\n    validate: (data: unknown) => {\n        const result = ____moose____typia.createValidate<import(\"@514labs/moose-lib\").StripDateIntersection<Bar>>()(data);\n        return {\n            success: result.success,\n            data: result.success ? result.data : undefined,\n            errors: result.success ? undefined : result.errors\n        };\n    },\n    assert: ____moose____typia.createAssert<import(\"@514labs/moose-lib\").StripDateIntersection<Bar>>(),\n    is: ____moose____typia.createIs<import(\"@514labs/moose-lib\").StripDateIntersection<Bar>>()\n});\n"]}